!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.defaultSpriteConfig={fontSize:36,fontColor:"#fff",fontFamily:"Microsoft YaHei",avatarSize:50,type:"text",padding:[12,12,12,12],radius:20},e.defaultGlobalConfig={type:"scroll",lifeTime:200},e.imageAndTextSpace=12,e.screenSpace=32,e.employTrackSpaceX=20,e.employTrackSpaceY=20},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createId=function(t=""){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t+(e()+e()+"-")+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.wait=function(t=1e3){return new Promise(e=>{setTimeout(()=>{e()},t)})},e.createCanvas=(t,e,i)=>{const n=window.document.createElement("canvas");return n.id=t,n.width=e,n.height=i,n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.loadingImage=t=>new Promise(e=>{const i=new Image;i.crossOrigin="",i.src=t,i.onload=()=>{e(i)},i.onerror=()=>{e(null)}}),e.getRandomColor=()=>"rgb("+parseInt(String(255*Math.random()))+","+parseInt(String(255*Math.random()))+","+parseInt(String(255*Math.random()))+")",e.mixConfig=(t,e)=>(Object.keys(e).forEach(i=>{void 0===t[i]&&(t[i]=e[i])}),t),e.getCanUseTrack=function(t,e,i){const s=[];if(0!==t.length){const i=t.map(t=>t.split(",").map(t=>parseFloat(t))).sort((t,e)=>t[0]>e[0]?1:-1),a=[];i.forEach((t,e)=>{if(0===e)return void a.push(t);const i=a[a.length-1],[s,o]=t;i[1]+n.employTrackSpaceY>s?i[1]=o:a.push(t)});const[o]=a[0],[,r]=a[a.length-1];if(e[0]<o&&s.push([e[0],o]),e[1]>r&&s.push([r,e[1]]),a.length>1){let t;a.forEach(e=>{void 0===t?t=e[1]:(s.push([t,e[0]]),t=e[0])})}}else s.push([...e]);for(let t=0;t<s.length;t+=1){const e=s[t];if(e[1]-e[0]>i+n.employTrackSpaceY)return[e[0],e[0]+i+n.employTrackSpaceY]}return null}},,function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(i(9)),a=n(i(10)),o=i(2),r=i(0);e.default=class{constructor(t,e={}){this.globalConfig=o.mixConfig(e,r.defaultGlobalConfig),this.scene=new s.default(t,this.globalConfig),this.stop=this.scene.stop.bind(this.scene),this.start=this.scene.start.bind(this.scene),this.clear=this.scene.clear.bind(this.scene)}add({content:t,avatar:e}){this.scene.add(new a.default({avatar:e,content:t},{ctx:this.scene.ctx}))}}},,,,function(t,e,i){"use strict";i.r(e);var n=i(4),s=i.n(n);window.barrage=new s.a(document.getElementById("webgl"),{type:"scroll"});let a=0;window.add=()=>{window.timer=setInterval(()=>{window.barrage.add({content:"李四：你好呀 🤘🏻111",avatar:"http://thirdwx.qlogo.cn/mmopen/vi_32/JqfbL9Z2prhybabOMfPUELUQAichrtTLCWFCUr6hTicMCE77qwSPsHm7wRNpzPY2kdG3RrlLco6shVAiatGtsIDgw/132"}),(a+=1)>500&&clearInterval(window.time)},100)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(2),s=i(1),a=i(0),o=i(1);let r=!1;class c{constructor(t,e){this.timer=null,this.sprites={},this.queue=[],this.employTrack={},this.initCanvas(t),this.globalConfig=e,this.status=!0,window.addEventListener("resize",this.resize.bind(this))}static get status(){return r}set status(t){r!==t&&((r=t)?null===this.timer&&this.run():this.stop())}calcAnimation(t,e=12){const[i]=t;if("reversescroll"===this.globalConfig.type){return{position:[-i,e],speed:[(this.containerWidth+i)/this.globalConfig.lifeTime,0],rangeWidth:[-i,this.containerWidth+i]}}const n=-(this.containerWidth+i)/this.globalConfig.lifeTime;return{position:[this.containerWidth,e],speed:[n,0],rangeWidth:[-i,this.containerWidth]}}add(t){t.id=s.createId("sprite-"),this.queue.push(t)}addSprite(t,e){t.setAnimation(this.calcAnimation(t.rect,e)),this.sprites[t.id]=t}calcEmployTrack(t){const e=Object.values(this.employTrack),i=n.getCanUseTrack(e,this.trackTop,t);return i||null}calcPosition(){if(0===this.queue.length)return;const[t]=this.queue,[,e]=t.rect,i=this.calcEmployTrack(e);i&&(this.employTrack[t.id]=i.toString(),t.employTrack=!0,this.addSprite(t,i[0]),this.queue.shift())}start(){this.status=!0}stop(){this.timer=null,this.status=!1}clear(){this.sprites={}}run(){if(!c.status)return;this.calcPosition(),this.render();const t=this.run.bind(this);this.timer=window.requestAnimationFrame(t)}resize(){this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.offsetHeight}initCanvas(t){const{offsetWidth:e,offsetHeight:i}=t;this.container=t,this.containerWidth=e,this.containerHeight=i;const n=o.createCanvas("canvas-huiyidun",e,i);n.style.position="absolute",n.style.display="block",this.container.append(n),this.ctx=n.getContext("2d"),this.trackTop=[a.screenSpace,this.containerHeight-a.screenSpace]}render(){this.ctx.clearRect(0,0,this.containerWidth,this.containerHeight),Object.keys(this.sprites).forEach(t=>{const e=this.sprites[t];e.animation({type:this.globalConfig.type,containerWidth:this.containerWidth}),!e.employTrack&&this.employTrack[e.id]&&delete this.employTrack[e.id],e.status?e.render(this.ctx):delete this.sprites[t]})}}e.default=c},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function r(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),a=i(0);class o{constructor(t,e){this.status=!0,this.speed=[1,1],this.position=null,this.employTrack=!1;const{avatar:i,fontFamily:n,fontColor:o,fontSize:r,avatarSize:c,content:h,padding:l,radius:d}=s.mixConfig(t,a.defaultSpriteConfig);this.content=h,this.style={padding:l,avatarSize:c,radius:d},this.font={fontFamily:n,fontColor:o,fontSize:r},this.loadingImage(i),this.rect=this.calcRect(e.ctx);const u=document.createElement("canvas");u.width=this.rect[0],u.height=this.rect[1],this.templateCanvas=u,this.getImageData()}set avatarStatus(t){t&&this.getImageData()}getImageData(){this.templateCtx=this.templateCanvas.getContext("2d"),this.templateCtx.clearRect(0,0,this.rect[0],this.rect[1]),this.draw(this.templateCtx)}render(t){t.drawImage(this.templateCanvas,...this.position)}loadingImage(t){(()=>n(this,void 0,void 0,(function*(){t&&(this.avatar=(yield s.loadingImage(t))||null,this.avatarStatus=!0)})))()}calcRect(t){const[e,i,n,s]=this.style.padding;t.save(),t.font=`${this.font.fontSize}px ${this.font.fontFamily}`;const o=t.measureText(this.content);t.restore();const r=this.style.avatarSize+a.imageAndTextSpace+o.width+s+i,c=Math.max(this.style.avatarSize,this.font.fontSize)+e+n;return[Math.floor(r),c]}setAnimation({position:t,speed:e,rangeWidth:i}){this.position=t,this.speed=e,this.rangeWidth=i}draw(t){const[,,e]=this.style.padding,i=(this.rect[1]-this.style.avatarSize)/2;this.avatar&&"string"!=typeof this.avatar&&o.drawAvatar(t,{img:this.avatar,position:[e,i],imageHeight:this.style.avatarSize,imageWidth:this.style.avatarSize,radius:this.style.radius});const n=(this.rect[1]-this.font.fontSize-5)/2;this.drawText(t,{left:this.style.avatarSize+a.imageAndTextSpace+e,top:n}),this.drawBorder(t)}static checkEmployTrack({left:t,width:e,type:i,containerWidth:n}){return!("reversescroll"===i&&t>a.employTrackSpaceX)&&!("scroll"===i&&t<n-e-a.employTrackSpaceX)}animation({type:t,containerWidth:e}){if(!this.position)return;const i=this.position[0]+this.speed[0],n=this.position[1]+this.speed[1];this.rangeWidth&&(this.rangeWidth[0]>i||this.rangeWidth[1]<i)?this.status=!1:(this.position=[i,n],this.employTrack&&(this.employTrack=o.checkEmployTrack({left:i,type:t,containerWidth:e,width:this.rect[0]})))}remove(){this.status=!1}drawBorder(t,e={}){const{left:i=0,top:n=0}=e,[s,a]=this.rect;t.shadowOffsetX=3,t.shadowOffsetY=3,t.shadowBlur=12,t.shadowColor="rgba(46, 141, 239, 0.4)",t.strokeStyle="rgba(46, 141, 239, 1)",t.strokeRect(i,n,s,a)}drawText(t,{left:e=0,top:i=0}){t.fillStyle=this.font.fontColor,t.font=`${this.font.fontSize}px ${this.font.fontFamily}`,t.textAlign="left",t.textBaseline="top",t.fillText(this.content,e,i)}static drawAvatar(t,e){const{img:i,imageWidth:n,imageHeight:s,position:a}=e;let{radius:o}=e;o=o>Math.max(n,s)/2?Math.max(s,n)/2:o;const[r,c]=a;if(t.save(),i){t.beginPath(),t.moveTo(r+o,c),t.lineTo(r+n-o,c),t.quadraticCurveTo(r+n,c,r+n,c+o),t.lineTo(r+n,c+s-o),t.quadraticCurveTo(r+n,c+s,r+n-o,c+s),t.lineTo(r+o,c+s),t.quadraticCurveTo(r,c+s,r,c+s-o),t.lineTo(r,c+o),t.quadraticCurveTo(r,c,r+o,c),t.closePath(),t.clip();const{width:e,height:a}=i;t.drawImage(i,0,0,e,a,r,c,n,s)}t.restore()}}e.default=o}]);
//# sourceMappingURL=danmu.js.map